extends layout

block content
  .uk-container

    .header-transparent
      .menu-home
        a(href="/")
          .menu-icon
              span(uk-icon="icon: home")

    .dashb_section.extra-margin
      .uk-card.uk-card-default.uk-card-body.card-border-radius
        .uk-card-title
            | Run Test 
        .uk-margin
            p Select Processing Method
            .uk-margin
              select.uk-select#selectmethod(onchange='updateframework();') 
                option(value='batch') Batch-only
                option(value='stream') Stream-only
                //option(value='hybrid') Hybrid
        .uk-margin
            p Select framework
            .uk-margin
              select.uk-select#selectframework 
        
        .uk-margin
            button.uk-button.uk-button-primary(type="submit" onclick='scheduledTasks();') Add Test
    
    .dashb_section.min-margin
      .uk-card.uk-card-default.uk-card-body.card-border-radius
        .uk-card-title
            | Scheduled Tests
        
        //schedule list goes here
        .uk-margin#scheduledtasks
        .uk-margin
            form(method='post' action='/sorter')
                input#secretinput(type='hidden' name='jobs' value='')
                a(href="/progress")
                    button.uk-button.uk-button-primary(type="submit") Run Jobs
                button.uk-button.uk-button-default.uk-float-right(type="button" onclick='clearList();') Clear Job List

  script.
    var bar = document.getElementById('js-progress');

    UIkit.upload('.js-upload', {

        url: '',
        multiple: true,

        beforeSend: function () {
            console.log('beforeSend', arguments);
        },
        beforeAll: function () {
            console.log('beforeAll', arguments);
        },
        load: function () {
            console.log('load', arguments);
        },
        error: function () {
            console.log('error', arguments);
        },
        complete: function () {
            console.log('complete', arguments);
        },

        loadStart: function (e) {
            console.log('loadStart', arguments);

            bar.removeAttribute('hidden');
            bar.max = e.total;
            bar.value = e.loaded;
        },

        progress: function (e) {
            console.log('progress', arguments);

            bar.max = e.total;
            bar.value = e.loaded;
        },

        loadEnd: function (e) {
            console.log('loadEnd', arguments);

            bar.max = e.total;
            bar.value = e.loaded;
        },

        completeAll: function () {
            console.log('completeAll', arguments);

            setTimeout(function () {
                bar.setAttribute('hidden', 'hidden');
            }, 1000);

            //alert('Upload Completed');
        }

    });

    //document onload actions
    window.onload = function(){
        //update frameworks
        updateframework();


    }

    //empty the options
    function resetOptions(id){
        var options = id.options;
        options.length = 0;
    }


    //update framework list
    function updateframework(){
        var selected = document.getElementById('selectmethod').value;
        var frameworks = document.getElementById('selectframework');
        //reset the options
        resetOptions(frameworks);


        //add otions
        var hadoop = document.createElement('option');
        hadoop.value = 'hadoop';
        hadoop.text  = 'Apache Hadoop';

        var storm = document.createElement('option');
        storm.value = 'storm';
        storm.text  = 'Apache Storm';

        var samza = document.createElement('option');
        samza.value = 'samza';
        samza.text  = 'Apache Samza';

        var spark = document.createElement('option');
        spark.value = 'spark';
        spark.text  = 'Apache Spark';

        var flink = document.createElement('option');
        flink.value = 'flink';
        flink.text  = 'Apache Flink';

        if(selected == "batch"){
            //console.log("batch selected")
            frameworks.add(hadoop, null);
            frameworks.add(spark, null);
            frameworks.add(flink, null);
        }else if(selected == "stream"){
            //console.log("stream selected")
            frameworks.add(storm, null);
            frameworks.add(samza, null);
            frameworks.add(spark, null);
            frameworks.add(flink, null);
        }
        //- }else if(selected == "hybrid"){
        //-     //console.log("hybrid selected")
        //-     frameworks.add(spark, null);
        //-     frameworks.add(flink, null);
        //- }
        else{
            console.log("nothing selected")
        }
    }

    /** global var **/
    var schedule = [];

    //schedule the tasks for executing
    function scheduledTasks(){
        var process = document.getElementById('selectmethod').value;
        var framework = document.getElementById('selectframework').value;

        var sch = {
            "job" : {
                "method": process,
                "framework" : framework
            }
        }

        //add the job to list
        schedule.push(sch);
        
        //update the schedule list
        updateList();

        console.log(schedule);
    }

    //clear the jobs
    function clearList(){
        schedule = [];
        updateList();

        console.log(schedule);
    }

    //update the scheduled list dynamically
    function updateList(){
        var scheduler = document.getElementById('scheduledtasks');
        //enter the updated list into post input
        var secretjob = document.getElementById('secretinput').value = JSON.stringify(schedule);
        
        //empty before update
        scheduler.innerHTML = "";
        for(var i = 0; i < schedule.length; i++){
            var content = "<div class='sch-test-cont'><b>Job "+ (i+1) +"</b> Apache "+schedule[i].job.framework+" | "+schedule[i].job.method+"</div>";

            //add the job to list
            scheduler.innerHTML += content;
        }
    }